<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Kwort Linux</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<link rel="stylesheet" href="css/bootstrap.css" media="screen">
		<link rel="stylesheet" href="css/custom.min.css">
	</head>
	<body style="display: flex; flex-direction:column;">
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
			<a class="navbar-brand" href="index.html">Kwort Linux</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navbarColor02">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item">
						<a class="nav-link" href="news.html">News</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="screenshots.html">Screenshots</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="download.html">Download</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="software.html">Software</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" href="documentation.html">Documentation</a>
					</li>
				</ul>
			</div>
		</nav>
		<br>
		<div class="container">
			<div class="row" style="margin-bottom: 2rem;">
				<div class="col-lg-3">
					<div class="list-group">
						<a href="installation.html" class="list-group-item list-group-item-action">Installation documentation</a>
						<a href="configuration.html" class="list-group-item list-group-item-action">Configuring the system</a>
						<a href="packaging.html" class="list-group-item list-group-item-action active">Packaging system</a>
						<a href="operability.html" class="list-group-item list-group-item-action">GUI setup</a>
						<a href="faq.html" class="list-group-item list-group-item-action">FAQ</a>
					</div>
				</div>
				<div class="col-lg-8">

					<h2>Package System</h2>

					<p>Kwort package system is very simple, just tar packages containing the binaries compressed with a format supported by libarchive (we normally use xz). If your package needs the execution of extra commands after being decompressed, the /install/doinst.sh script is excecuted.</p>
					<p>This page explains the usage of kpkg and makepkg. The first one is used to manage your packages (install, remove, upgrade packages, etc...),	while the second one is used to create packages.</p>

					<h4>kpkg</h4>
					<p>kpkg is Kwort's package manager, it can handle packages created for Kwort in formats supported by libarchive: txz, tbz2 or .tgz are valid options, although txz/tar.xz are the ones prefered for Kwort. It can install packages from our mirrors or any other you choose. It has a few options, including the basics, likeinstalling and removing software, and more	advanced features.</p>
					<p>Usage: <code>kpkg &lt;ACTION&gt; [PACKAGE[S]|FILE ...]</code></p>

					<h5>OPTIONS</h5>

					<b>update:</b>
					<p>This option updates a package database from all mirrors installed or from the mirror you chose from. s section down here.</p>
					<b>Examples:</b>
					<pre style="background: #222; color: #e83e8c;">
  kpkg update
  kpkg update europa
					</pre>

					<b>install PACKAGE1 [PACKAGE2 ...]:</b>
					<p>This option allows you to install a package from a local place or from the chosen mirrors.</p>
					<b>Examples:</b>
					<pre style="background: #222; color: #e83e8c;">
  kpkg install openvpn
  kpkg install go libseccomp btrfs-progs cgroupfs-mount containerd runc docker
  kpkg install /home/user/mypackage#1.0#x86_64#1.tar.xz
					</pre>

					<b>remove PACKAGE1 [PACKAGE2 ...]:</b>
					<p>Use this option to remove installed packages.</p>
					<b>Examples:</b>
					<pre style="background: #222; color: #e83e8c;">
  kpkg remove openvpn
  kpkg remove go libseccomp btrfs-progs cgroupfs-mount containerd runc docker
					</pre>
					<i>CAVEAT: This option does not remove packages installed from source. Only packages installed with kpkg.</i>

					<b>download PACKAGE1 [PACKAGE2 ...]:</b>
					<p>With this option you download packages from the mirror but don't install them. The downloaded packages go to /var/packages/downloads.</p>
					<b>Examples:</b>
					<pre style="background: #222; color: #e83e8c;">
  kpkg download openvpn
					</pre>

					<b>search PACKAGE1 [PACKAGE2 ...]:</b>
					<p>This option only search a package in the database, it doesn't install or remove any package. It doesn't modify the database at all. If you want to know all packages in the database, you can use "/all" as package name.</p>
					<b>Examples:</b>
					<pre style="background: #222; color: #e83e8c;">
  kpkg search openvpn
					</pre>

					<b>provides FILE:</b>
					<p>This option allows you to know which package installed by kpkg is providing a given file.</p>
					<b>Examples:</b>
					<pre style="background: #222; color: #e83e8c;">
  kpkg provides bin/ls
					</pre>

					<b>instkdb FILE or LINK:</b>
					<p>This option allow you to install a kdb file that contains a database mirror definition. Its argument can be a local kdb file or a link to a kdb file.</p>
					<b>Examples:</b>
					<pre style="background: #222; color: #e83e8c;">
  kpkg instkdb /root/ctrl-c.kdb
  kpkg instkdb http://ctrl-c.club/~nomius/kwort/4.3.4/ctrl-c.kdb
					</pre>

					<h5>ENVIRONMENT</h5>

					<b>ROOT:</b>
					<p>This option is used to set a path to an installation. Leave it empty to install in the root (/). Accepted value is a full directory name.</p>
					<b>Examples:</b>
					<pre style="background: #222; color: #e83e8c;">
  ROOT=/opt kpkg install openvpn
					</pre>
					<i>CAVEAT: Note that if you change this variable you might also probably change also KPKG_DB_HOME, to point the installed packages database to </i><code>$ROOT/var/packages/installed.kdb</code>.
					<br>
					<br>

					<b>KPKG_DB_HOME:</b>
					<p>This option is used to set a path where the database is. You can work with this with several database using them completely separated. Leave it empty to use the default database path (<code>/var/packages/installed.kdb</code>).</p>
					<b>Examples:</b>
					<pre style="background: #222; color: #e83e8c;">
  KPKG_DB_HOME=/home/nomius/installed.kdb kpkg install openvpn
					</pre>

					<b>CSV:</b>
					<p>Using the search command will produce a human readable form list of installed packages, setting this variable to "yes" will make its output to be in csv format. This option is useful for front-ends where the output of kpkg must be piped to another program.</p>
					<b>Examples:</b>
					<pre style="background: #222; color: #e83e8c;">
  CSV=yes kpkg search /all
					</pre>

					<b>MIRROR:</b>
					<p>If you have a package on several mirrors and you don't want to be prompted when installing, you can set this variable the the mirror name. The mirror name is the name of the database without its extension.</p>
					<b>Examples:</b>
					<pre style="background: #222; color: #e83e8c;">
  MIRROR=ctrl-c kpkg install openvpn
					</pre>

					<h4>Packaging with makepkg</h4>
					<i>NOTE: The next documentation was taken from the Slackware documentation and slighted modified to apply to Kwort</i>

					<p>makepkg was borrowed from Slackware and rewritten to create Kwort specific packages. In order to create a package, you will need to have the binary files for the package you want to create. Obviously this means you will need to either have the binary files already available in your system, or you will have to build the binary files from the source files. Here are the steps you need to follow to create a package:</p>

					<ul>
						<li>create a directory tree</li>
						<li>copy all the files related to the package into the appropriate directories in the directory tree.</li>
						<li>run makepkg to create the package.</li>
					</ul>

					<p>I would advice you to create a directory where you will package your packages; for instance, something like /pkg. This is where you will create your directory tree. /pkg will simple contain the location on where the files in the package you are creating will be installed. For instance, foo#1.0#x86_64#1.tar.xz will install the binary file foo in /usr/bin and a configuration file foorc in /usr/etc. Therefore, /pkg will contain the following directories:</p>

					<pre style="background: #222; color: #e83e8c;">
  /pkg/usr/bin
  /pkg/usr/etc
					</pre>

					<p>The next step is to copy all the files to the directory tree. So in this case, there are only two files to foo#1.0#x86_64#1.tar.xz, and they are foo and foorc. We then copy the files to where they will be installed, in this case, /usr/bin and /usr/etc respectively. When that is done with, we do the following:</p>

					<pre style="background: #222; color: #e83e8c;">
  cd /pkg
  makepkg -s -c -z foo#1.0#x86_64#1.tar.xz
					</pre>

					<p>This will create a package called foo#1.0#x86_64#1.tar.xz which contains the files foo and foorc which will be installed in /usr/bin and /usr/etc respectively. Also, given the options -s, -c and -z was given, it will strip binaries (in this case <code>/usr/bin/foo</code>), chown all files to root:root and compress man pages if any.</p>

					<p>As you probably noted, you will need to hunt around for the files and then to copy them to the created directory tree. An easier way to do this would be to build the package from source, and then have the built binaries installed into the directory tree. If for instance we have downloaded a source package called foo-1.0.tar.gz. We have already created a directory /pkg it is currently empty. The first thing to do is to unpack the source file and then to build the source. A full sequence of a software source which uses autotools would be:</p>

					<pre style="background: #222; color: #e83e8c;">
  tar xvzf foo-1.0.tar.gz
  cd foo-1.0
  ./configure --prefix=/usr
  make
  make DESTDIR=/pkg install
  cd /pkg
  makepkg -s -z -c foo#1.0#x86_64#1.tar.xz
					</pre>

					<p>The line <code>./configure --prefix=/usr</code> will build the package in order to get configured for the real system in usr. The line <code>make DESTDIR=/pkg install</code> will cause the known <code>make install</code> to install all files into <code>/pkg</code> while at the same time, building the directory tree for you. So when you are done, just go to <code>/pkg</code> and run <code>makepkg</code> from within it, and it will automatically build the package for you. If the source package doesn't use autotools, then you will have to build and find out where the files will be installed in. Fortunately, most major source packages will require you to make use of the <code>./configure</code> stage.</p>

					<h5>Important notes on official packages</h5>
					<b>If you pretend your package to be in the official mirror, first of all your package must apply some rules:</b>

					<ol>
						<li>Nothing goes to /usr/local, your package prefix should be /usr unless it's for file systems or networking, which in that case should be / (depends on the criteria).</li>
						<li>All man pages must be in /usr/man (and not /usr/share/man).</li>
						<li>All man pages must be gziped.</li>
						<li>There's no /usr/libexec, so don't create one with your packages. libexecdir should be /usr/lib/package.</li>
						<li>Stay clean!</li>
					</ol>

					<p>The fact that you did all that doesn't mean that your package is gonna be in the official mirror, as your package must be stable, well tested, etc. But at first sight it will not be rejected because you didn't "follow the book".</p>
				</div>
			</div>
		</div>
		<br>
		<br>
		<br>
		<div class="footer bg-dark" style="text-align:center; padding: 1.6rem 1rem; position: fixed; left: 0; bottom: 0; width: 100%;">Copyright Kwort Linux - 2002-2019</div>
		<script src="js/jquery.min.js"></script>
		<script src="js/popper.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/custom.js"></script>
	</body>
</html>
